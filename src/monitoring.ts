import autocannon from "autocannon";

const args = process.argv.slice(2);

const url = args
  .find((arg) => arg.startsWith("--url="))
  ?.replace("--url=", "")
  .replace(/\/$/, "");

const testTransactionsMonitoring = () => {
  if (!url) {
    console.log("ERROR: invalid url");
    return;
  }

  const data = [
    {
      message:
        '{"transaction":{"from":"0x038668815ad4247cd10c07a7c4a6b77eb47e4533","to":"0xd3c325848d7c6e29b574cb0789998b2ff901f17e","value":"0x0","data":"0x095ea7b3000000000000000000000000c690467799458052122d41287ca8d3b6f606971cffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"},"chainId":"eip155:38"}',
      signature: "string",
    },
    {
      message:
        '{"transaction":{"from":"0x1845ab00d00c3fdd8050f493fc3f05f7b6a01077","to":"0xb45a2dda996c32e93b8c47098e90ed0e7ab18e39","value":"0x0","data":"0xc10bea5c000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055d398326f99059ff775485246999027b31979550000000000000000000000001bec5734b1e4559979158052dfa5c6f0156282f2000000000000000000000000661d4d4785c302a56d7cb8a92f130d319bc25e4a0000000000000000000000001845ab00d00c3fdd8050f493fc3f05f7b6a01077000000000000000000000000000000000000000000000002fb474098f67c000000000000000000000000000000000000000000000000000157db73c789e3a16c00000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bb4cdb9cbd36b01bd1cbaebf2de08d9173bc095c0000000000000000000000000000000000000000000000000000000000000007616e64726f696400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000055d398326f99059ff775485246999027b31979550000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000038000000000000000000000000000000000000000000000000000000000000000200000000000000000000000001bec5734b1e4559979158052dfa5c6f0156282f20000000000000000000000001845ab00d00c3fdd8050f493fc3f05f7b6a0107700000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120000000000000000000000000000000000000000000000000000000000000016000000000000000000000000000000000000000000000000000000000000001a000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000"},"chainId":"eip155:38"}',
      signature: "string",
    },
    {
      message:
        '{"transaction":{"from":"0x1845ab00d00c3fdd8050f493fc3f05f7b6a01077","to":"0xb2f53069e1555793481aafe639f8e274f4ec8435","value":"0x0","data":"0xa9059cbb000000000000000000000000ea42483e617cdca46fe7d57a448c65509b6bcefc0000000000000000000000000000000000000000000000004edb23296122995a"},"chainId":"eip155:38"}',
      signature: "string",
    },
    {
      message:
        '{"transaction":{"from":"0x1845ab00d00c3fdd8050f493fc3f05f7b6a01077","to":"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31","value":"0x0","data":"0x5f5755290000000000000000000000000000000000000000000000000000000000000080000000000000000000000000b2f53069e1555793481aafe639f8e274f4ec84350000000000000000000000000000000000000000000000004563918244f4000000000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000000c307846656544796e616d696300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280000000000000000000000000b2f53069e1555793481aafe639f8e274f4ec843500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004563918244f40000000000000000000000000000000000000000000000000000013081e111111dd800000000000000000000000000000000000000000000000000000000000001200000000000000000000000000000000000000000000000000002c56642a16da700000000000000000000000011ededebf63bef0ea2d2d071bdf88f71543ec6fb00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000148c43c9ef600000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000004563918244f40000000000000000000000000000000000000000000000000000013331ff239e579100000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000b2f53069e1555793481aafe639f8e274f4ec843500000000000000000000000055d398326f99059ff775485246999027b3197955000000000000000000000000eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee869584cd00000000000000000000000011ededebf63bef0ea2d2d071bdf88f71543ec6fb000000000000000000000000000000000000000000000018e1a78988628106df000000000000000000000000000000000000000000000000"},"chainId":"eip155:38"}',
      signature: "string",
    },
    {
      message:
        '{"transaction":{"from":"0x387586e00bd16e1bd70a4e36dd9eaf1f5d4ed194","to":"0x55d398326f99059ff775485246999027b3197955","value":"0x0","data":"0x095ea7b30000000000000000000000002592ae802bc3e08488ababd28136030f148f2d100fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"},"chainId":"eip155:38"}',
      signature: "string",
    },
    {
      message:
        '{"transaction":{"from":"0x74173eaf3f7c59e616ee658616104fb6169712c1","to":"0x1a1ec25dc08e98e5e93f1104b5e5cdd298707d31","value":"0x0","data":"0x5f57552900000000000000000000000000000000000000000000000000000000000000800000000000000000000000008ac76a51cc950d9822d68b83fe1ad97b32cd580d000000000000000000000000000000000000000000000003cb71f51fc558000000000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000000017616972737761704c696768743346656544796e616d696300000000000000000000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000063ecd84b0000000000000000000000000000000000000000000000000000000063ecd8e1000000000000000000000000945bcf562085de2d5875b9e2012ed5fd5cfab927000000000000000000000000e9e7cea3dedca5984780bafc599bd69add087d56000000000000000000000000000000000000000000000003c34924850c410bc00000000000000000000000008ac76a51cc950d9822d68b83fe1ad97b32cd580d000000000000000000000000000000000000000000000003c43a30ee01a9c000000000000000000000000000000000000000000000000000000000000000001c2c1336428a5200e0e9dbfa4ebae59fc28f8532e1bb1470f79c3574e4b6b4809e703fb10cbcce3dbb3a1a7945851d8855674ed69a424dbe37dae9c5d259d0f56d0000000000000000000000000000000000000000000000000737c431c3ae4000000000000000000000000000b28da7bc87a9dd1e60849aa7fcb5da24ea913c420000000000000000000000000000000000000000000000000000000000000000"},"chainId":"eip155:38"}',
      signature: "string",
    },
    {
      message:
        '{"transaction":{"from":"0xc51503b0a2bd89ed74f4da6af6fbfcc8e678fd83","to":"0xf3147987a00d35eecc10c731269003ca093740ca","value":"0x0","data":"0xa9059cbb000000000000000000000000b640bad2407a5901b65a45deb5ba4ee495c730b70000000000000000000000000000000000000000000000007cbfc9791a645098"},"chainId":"eip155:38"}',
      signature: "string",
    },
    {
      message:
        '{"transaction":{"from":"0xe790ec9a76cd938d7ed5029af57ce53ffe2b0f65","to":"0xd0959d536e3dc746c1f0e3981a2de41d585b67bf","value":"0x0","data":"0x095ea7b300000000000000000000000010ed43c718714eb63d5aa57b78b54704e256024effffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"},"chainId":"eip155:38"}',
      signature: "string",
    },
  ];

  const getBody = (data: any) => JSON.stringify(data);

  autocannon(
    {
      url,
      title: "Transactions monitoring",
      connections: 100, //10
      pipelining: 10, //10
      duration: 60, //20
      workers: 4, //4
      requests: data.map((i) => {
        return {
          method: "POST",
          path: "/api/transaction/check",
          body: getBody(i),
          headers: {
            "Content-Type": "application/json",
          },
        };
      }),
    },
    (err, result) => {
      if (err) {
        console.log(err);
      } else {
        console.log(result);
      }
    }
  );
};

testTransactionsMonitoring();
